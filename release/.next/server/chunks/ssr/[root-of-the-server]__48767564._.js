module.exports=[38735,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"registerServerReference",{enumerable:!0,get:function(){return d.registerServerReference}});let d=a.r(80846)},63985,a=>{"use strict";var b=a.i(61469),c=a.i(37137),d=a.i(9307),e=a.i(54626);async function f(a,f,g,h){try{let i=null,j="system";if(h)i=h.id,j=h.username;else{let a=await (0,d.getSession)();a&&(i=a.user.id,j=a.user.username)}let k="CONTACT_SUBMISSION"===a||"AUTH_LOGIN_FAILED"===a,l=a.startsWith("SYSTEM_")||a.startsWith("WEBHOOK_");if(!i&&!k&&!l)return;let m=await (0,e.headers)(),n=(m.get("x-forwarded-for")||m.get("x-real-ip")||"unknown").split(",")[0].trim().substring(0,45),o=m.get("user-agent")?.substring(0,255)||null;await b.db.insert(c.auditLogs).values({userId:i,usernameSnapshot:j,action:a,entityId:f,details:g?.substring(0,65535)||null,ipAddress:n,userAgent:o})}catch(a){console.error("[Audit] Failed to create audit log:",a)}}a.s(["createAuditLog",()=>f])},98246,(a,b,c)=>{"use strict";function d(a){for(let b=0;b<a.length;b++){let c=a[b];if("function"!=typeof c)throw Object.defineProperty(Error(`A "use server" file can only export async functions, found ${typeof c}.
Read more: https://nextjs.org/docs/messages/invalid-use-server-value`),"__NEXT_ERROR_CODE",{value:"E352",enumerable:!1,configurable:!0})}}Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"ensureServerEntryExports",{enumerable:!0,get:function(){return d}})},63707,a=>{"use strict";var b=a.i(38735),c=a.i(61469),d=a.i(37137),e=a.i(3766),f=a.i(50588),g=a.i(9307),h=a.i(54626);a.i(94490);var i=a.i(40356),j=a.i(93411),k=a.i(63985),l=a.i(98246);let m=j.z.object({email:j.z.string().email({message:"Invalid email address"}),password:j.z.string().min(1,{message:"Password is required"})});async function n(a,b){let j=b.get("email"),l=b.get("password"),n=m.safeParse({email:j,password:l});if(!n.success)return{error:n.error.flatten().fieldErrors};let o=(await c.db.select().from(d.users).where((0,e.eq)(d.users.email,j)).limit(1))[0];if(!o||!o.isActive)return await (0,k.createAuditLog)("AUTH_LOGIN_FAILED",void 0,`Attempted email: ${j} (User not found or inactive)`),{message:"Email atau password salah"};if(!await (0,f.compare)(l,o.passwordHash))return await (0,k.createAuditLog)("AUTH_LOGIN_FAILED",o.id,`Attempted email: ${j}`,{id:o.id,username:o.username}),{message:"Email atau password salah"};let p=Array.from(new Set((await c.db.select({slug:d.permissions.slug}).from(d.usersRoles).innerJoin(d.rolesPermissions,(0,e.eq)(d.usersRoles.rolesId,d.rolesPermissions.rolesId)).innerJoin(d.permissions,(0,e.eq)(d.rolesPermissions.permissionsId,d.permissions.id)).where((0,e.eq)(d.usersRoles.usersId,o.id))).map(a=>a.slug))),q=new Date(Date.now()+864e5),r=await (0,g.encrypt)({user:{id:o.id,username:o.username,email:o.email,permissions:p},expires:q});(await (0,h.cookies)()).set("session",r,{expires:q,httpOnly:!0}),await (0,k.createAuditLog)("AUTH_LOGIN_SUCCESS",o.id,`User logged in: ${o.username}`,{id:o.id,username:o.username}),(0,i.redirect)("/admin")}async function o(){await (0,k.createAuditLog)("AUTH_LOGOUT"),(await (0,h.cookies)()).delete("session"),(0,i.redirect)("/admin/login")}(0,l.ensureServerEntryExports)([n,o]),(0,b.registerServerReference)(n,"60700d1c86bf5db80f6bbf4b677e061a135cc02ef7",null),(0,b.registerServerReference)(o,"0065f74676de6a3b4836339edb2ac076d7e582b0d6",null),a.s(["login",()=>n,"logout",()=>o])},22734,(a,b,c)=>{b.exports=a.x("fs",()=>require("fs"))},21517,(a,b,c)=>{b.exports=a.x("http",()=>require("http"))},24836,(a,b,c)=>{b.exports=a.x("https",()=>require("https"))},24868,(a,b,c)=>{b.exports=a.x("fs/promises",()=>require("fs/promises"))},82341,a=>{"use strict";var b=a.i(38735),c=a.i(58313),d=a.i(61469),e=a.i(37137),f=a.i(9307),g=a.i(3766),h=a.i(12036),i=a.i(26092),j=a.i(56511),k=a.i(63985);async function l(a,b){if(!await (0,f.getSession)())throw Error("Unauthorized");try{await (0,f.checkPermission)(i.PERMISSIONS.MANAGE_MEDIA);let g=await c.mux.video.uploads.create({new_asset_settings:{playback_policy:["public"]},cors_origin:process.env.NEXT_PUBLIC_SITE_URL||"*"});return await d.db.insert(e.medias).values({name:a,fileKey:g.id,type:"video",provider:"mux",mimeType:"video/mux",fileSize:0,url:"",metadata:{uploadId:g.id,status:"uploading",folder:b||null}}).$returningId(),await (0,k.createAuditLog)("MEDIA_UPLOAD_INIT",void 0,`Initiated Mux upload: ${a}`),{id:g.id,url:g.url}}catch(a){throw console.error("Mux upload creation error:",a),Error("Failed to create Mux upload")}}async function m(a){if(!await (0,f.getSession)())throw Error("Unauthorized");try{await (0,f.checkPermission)(i.PERMISSIONS.MANAGE_MEDIA);let b=await d.db.select().from(e.medias).where((0,g.eq)(e.medias.fileKey,a)).limit(1);if(!b.length)return(await d.db.select().from(e.medias).where(h.sql`JSON_EXTRACT(${e.medias.metadata}, '$.uploadId') = ${a}`).limit(1))[0]||null;return b[0]}catch(a){return console.error("Get Mux media error:",a),null}}async function n(a){try{await (0,f.checkPermission)(i.PERMISSIONS.MANAGE_MEDIA);let b=await d.db.select().from(e.medias).where((0,g.eq)(e.medias.id,a)).limit(1);if(!b.length||"mux"!==b[0].provider)return;let h={};try{h="string"==typeof b[0].metadata?JSON.parse(b[0].metadata):b[0].metadata||{}}catch(a){console.error("Failed to parse metadata for sync",a)}if(!h?.assetId)return;let l=await c.mux.video.assets.retrieve(h.assetId);return await d.db.update(e.medias).set({metadata:{...h,status:l.status,duration:l.duration,aspectRatio:l.aspect_ratio}}).where((0,g.eq)(e.medias.id,a)),await (0,k.createAuditLog)("MEDIA_SYNC_MUX",a,`Synced Mux status for media ID: ${a}. New status: ${l.status}`),(0,j.revalidatePath)("/admin","layout"),l.status}catch(a){console.error("Mux sync error:",a)}}(0,a.i(98246).ensureServerEntryExports)([l,m,n]),(0,b.registerServerReference)(l,"600e0cdbe2c8d63481951c01b9e5bebcf0b714ea4a",null),(0,b.registerServerReference)(m,"40525e4ba1a0943968fe44ab212718ec6b0c2f1338",null),(0,b.registerServerReference)(n,"4061d271ac6c933535c19513a8303b6043c76aa3b4",null),a.s(["createMuxUpload",()=>l,"getMuxMediaByUploadId",()=>m,"syncMuxAssetStatus",()=>n])},98144,a=>{"use strict";var b=a.i(38735),c=a.i(61469),d=a.i(37137),e=a.i(3766),f=a.i(56511);a.i(94490);var g=a.i(40356),h=a.i(93411),i=a.i(9307),j=a.i(26092),k=a.i(63985),l=a.i(98246);let m=h.z.object({id:h.z.number(),isPrimary:h.z.boolean().default(!1),sortOrder:h.z.number().default(0),altText:h.z.string().nullable().default(null)}),n=h.z.object({name:h.z.string().min(1),sku:h.z.string().nullable().default(null),priceAdjustment:h.z.union([h.z.number(),h.z.string()]),stock:h.z.union([h.z.number(),h.z.string()]),isUnlimited:h.z.boolean()}),o=h.z.object({key:h.z.string().min(1),value:h.z.string().nullable().default(null)}),p=h.z.object({name:h.z.string().min(1,"Nama produk wajib diisi"),slug:h.z.string().min(1,"Slug wajib diisi"),description:h.z.string().optional(),basePrice:h.z.coerce.number().min(0,"Harga tidak boleh negatif"),isActive:h.z.coerce.boolean(),isFeatured:h.z.coerce.boolean(),showPrice:h.z.coerce.boolean(),categoryId:h.z.coerce.number().optional(),brandId:h.z.coerce.number().optional()});async function q(a,b){let e=await (0,i.getSession)();if(!e)return{message:"Sesi berakhir, silakan login kembali"};try{await (0,i.checkPermission)(j.PERMISSIONS.MANAGE_PRODUCTS)}catch{return{message:"Anda tidak memiliki izin untuk membuat produk"}}let l={name:b.get("name"),slug:b.get("slug"),description:b.get("description"),basePrice:b.get("basePrice"),isActive:"true"===b.get("isActive"),isFeatured:"true"===b.get("isFeatured"),showPrice:"true"===b.get("showPrice"),categoryId:b.get("categoryId")?Number(b.get("categoryId")):void 0,brandId:b.get("brandId")?Number(b.get("brandId")):void 0},q=[],r=[],s=[];try{q=h.z.array(m).parse(JSON.parse(b.get("medias")||"[]")),r=h.z.array(n).parse(JSON.parse(b.get("variants")||"[]")),s=h.z.array(o).parse(JSON.parse(b.get("specs")||"[]"))}catch{return{message:"Format data tambahan tidak valid"}}let t=p.safeParse(l);if(!t.success)return{error:t.error.flatten().fieldErrors};let{data:u}=t,v=null;try{let[a]=await c.db.insert(d.products).values({name:u.name,slug:u.slug,description:u.description,basePrice:u.basePrice,isActive:u.isActive,isFeatured:u.isFeatured,showPrice:u.showPrice,categoryId:u.categoryId,brandId:u.brandId,createdBy:e.user.id}).$returningId();v=a.id,q.length>0&&await c.db.insert(d.productMedias).values(q.map(a=>({productId:v,mediaId:a.id,isPrimary:a.isPrimary||!1,sortOrder:a.sortOrder||0,altText:a.altText}))),r.length>0&&await c.db.insert(d.productVariants).values(r.map(a=>({productId:v,name:a.name,sku:a.sku,priceAdjustment:Number(a.priceAdjustment),stockQuantity:Number(a.stock),isUnlimitedStock:a.isUnlimited}))),s.length>0&&await c.db.insert(d.productSpecifications).values(s.map(a=>({productId:v,specKey:a.key,specValue:a.value}))),await (0,k.createAuditLog)("PRODUCT_CREATE",v,`Created product: ${u.name}`)}catch(a){return console.error(a),{message:"Gagal membuat produk: "+(a instanceof Error?a.message:"Terjadi kesalahan tidak dikenal")}}(0,f.revalidatePath)("/admin/products","layout"),(0,f.revalidatePath)("/"),(0,f.revalidatePath)("/products","layout"),(0,g.redirect)(`/admin/products/${v}/edit`)}async function r(a,b,g){if(!await (0,i.getSession)())return{message:"Sesi berakhir, silakan login kembali"};try{await (0,i.checkPermission)(j.PERMISSIONS.MANAGE_PRODUCTS)}catch{return{message:"Anda tidak memiliki izin untuk mengubah produk"}}let l={name:g.get("name"),slug:g.get("slug"),description:g.get("description"),basePrice:g.get("basePrice"),isActive:"true"===g.get("isActive"),isFeatured:"true"===g.get("isFeatured"),showPrice:"true"===g.get("showPrice"),categoryId:g.get("categoryId")?Number(g.get("categoryId")):void 0,brandId:g.get("brandId")?Number(g.get("brandId")):void 0},q=[],r=[],s=[];try{q=h.z.array(m).parse(JSON.parse(g.get("medias")||"[]")),r=h.z.array(n).parse(JSON.parse(g.get("variants")||"[]")),s=h.z.array(o).parse(JSON.parse(g.get("specs")||"[]"))}catch{return{message:"Format data tambahan tidak valid"}}let t=p.safeParse(l);if(!t.success)return{error:t.error.flatten().fieldErrors};let{data:u}=t;try{await c.db.update(d.products).set({name:u.name,slug:u.slug,description:u.description,basePrice:u.basePrice,isActive:u.isActive,isFeatured:u.isFeatured,showPrice:u.showPrice,categoryId:u.categoryId,brandId:u.brandId}).where((0,e.eq)(d.products.id,a)),await c.db.delete(d.productMedias).where((0,e.eq)(d.productMedias.productId,a)),q.length>0&&await c.db.insert(d.productMedias).values(q.map(b=>({productId:a,mediaId:b.id,isPrimary:b.isPrimary||!1,sortOrder:b.sortOrder||0,altText:b.altText}))),await c.db.delete(d.productVariants).where((0,e.eq)(d.productVariants.productId,a)),r.length>0&&await c.db.insert(d.productVariants).values(r.map(b=>({productId:a,name:b.name,sku:b.sku,priceAdjustment:Number(b.priceAdjustment),stockQuantity:Number(b.stock),isUnlimitedStock:b.isUnlimited}))),await c.db.delete(d.productSpecifications).where((0,e.eq)(d.productSpecifications.productId,a)),s.length>0&&await c.db.insert(d.productSpecifications).values(s.map(b=>({productId:a,specKey:b.key,specValue:b.value}))),await (0,k.createAuditLog)("PRODUCT_UPDATE",a,`Updated product: ${u.name}`)}catch(a){return console.error(a),{message:"Gagal mengupdate produk: "+(a instanceof Error?a.message:"Terjadi kesalahan tidak dikenal")}}return(0,f.revalidatePath)("/admin/products","layout"),(0,f.revalidatePath)("/"),(0,f.revalidatePath)("/products","layout"),{success:!0,message:"Produk berhasil diperbarui"}}async function s(a,b){try{return await (0,i.checkPermission)(j.PERMISSIONS.MANAGE_PRODUCTS),await c.db.update(d.products).set({isFeatured:b}).where((0,e.eq)(d.products.id,a)),await (0,k.createAuditLog)("PRODUCT_TOGGLE_FEATURED",a,`Set featured to: ${b}`),(0,f.revalidatePath)("/admin/products","layout"),(0,f.revalidatePath)("/"),(0,f.revalidatePath)("/products","layout"),{success:!0}}catch(a){return{success:!1,message:a instanceof Error?a.message:"Gagal memperbarui status featured"}}}async function t(a){try{return await (0,i.checkPermission)(j.PERMISSIONS.MANAGE_PRODUCTS),await c.db.delete(d.products).where((0,e.eq)(d.products.id,a)),await (0,k.createAuditLog)("PRODUCT_DELETE",a,`Deleted product ID: ${a}`),(0,f.revalidatePath)("/admin/products","layout"),(0,f.revalidatePath)("/"),(0,f.revalidatePath)("/products","layout"),{success:!0}}catch(a){return{success:!1,message:a instanceof Error?a.message:"Gagal menghapus produk"}}}(0,l.ensureServerEntryExports)([q,r,s,t]),(0,b.registerServerReference)(q,"6084267b08e4a533fab282622dab8534381898172a",null),(0,b.registerServerReference)(r,"70eb3ba3e38c77a4a9baf36b877c65e4d805e7af6c",null),(0,b.registerServerReference)(s,"609ff3918006d0893c54e360a90a19ec2f9cdf4b94",null),(0,b.registerServerReference)(t,"403644fa86f0783befafc81c6ac0f95b126b22d6a2",null),a.s(["createProduct",()=>q,"deleteProduct",()=>t,"toggleProductFeatured",()=>s,"updateProduct",()=>r])},263,a=>{"use strict";var b=a.i(63707),c=a.i(98144),d=a.i(73492),e=a.i(82341);a.s([],46170),a.i(46170),a.s(["0039e6f4d93c612e9432cd78ee8cbc92260a14fa7c",()=>d.getPhysicalFolders,"00407ab671b4a0818fff7ed31ffb79f10f964adcd8",()=>d.syncFileSystemMedias,"0065f74676de6a3b4836339edb2ac076d7e582b0d6",()=>b.logout,"00cfd698a314c7d2a63fa7bd7fa56ea7cf3febe247",()=>d.getMedias,"4020377e801a0cc64e1a42febf16bf8e4995f2cf7f",()=>d.deleteMedia,"403644fa86f0783befafc81c6ac0f95b126b22d6a2",()=>c.deleteProduct,"40525e4ba1a0943968fe44ab212718ec6b0c2f1338",()=>e.getMuxMediaByUploadId,"4061d271ac6c933535c19513a8303b6043c76aa3b4",()=>e.syncMuxAssetStatus,"406ff7d3af401edf92b2984e240871274e46bb3446",()=>d.createPhysicalFolder,"40c944e5b0c4c33ee1ee96067b7c69a49106edc40b",()=>d.deletePhysicalFolder,"40d1fbcb5529ac8f2bc18816eb1d3c478818f9fbe2",()=>d.uploadFile,"600e0cdbe2c8d63481951c01b9e5bebcf0b714ea4a",()=>e.createMuxUpload,"6084267b08e4a533fab282622dab8534381898172a",()=>c.createProduct,"609ff3918006d0893c54e360a90a19ec2f9cdf4b94",()=>c.toggleProductFeatured,"60a088e6d105144a94fa2824812100df7fdd6a8818",()=>d.updateMediaFolder,"70eb3ba3e38c77a4a9baf36b877c65e4d805e7af6c",()=>c.updateProduct],263)},55492,a=>{a.v(b=>Promise.all(["server/chunks/ssr/[root-of-the-server]__b6139f65._.js"].map(b=>a.l(b))).then(()=>b(42991)))},60815,a=>{a.v(a=>Promise.resolve().then(()=>a(24868)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__48767564._.js.map