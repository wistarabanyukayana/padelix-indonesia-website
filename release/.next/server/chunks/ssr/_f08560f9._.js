module.exports=[38735,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"registerServerReference",{enumerable:!0,get:function(){return d.registerServerReference}});let d=a.r(80846)},63985,a=>{"use strict";var b=a.i(61469),c=a.i(37137),d=a.i(9307),e=a.i(54626);async function f(a,f,g,h){try{let i=null,j="system";if(h)i=h.id,j=h.username;else{let a=await (0,d.getSession)();a&&(i=a.user.id,j=a.user.username)}let k="CONTACT_SUBMISSION"===a||"AUTH_LOGIN_FAILED"===a,l=a.startsWith("SYSTEM_")||a.startsWith("WEBHOOK_");if(!i&&!k&&!l)return;let m=await (0,e.headers)(),n=(m.get("x-forwarded-for")||m.get("x-real-ip")||"unknown").split(",")[0].trim().substring(0,45),o=m.get("user-agent")?.substring(0,255)||null;await b.db.insert(c.auditLogs).values({userId:i,usernameSnapshot:j,action:a,entityId:f,details:g?.substring(0,65535)||null,ipAddress:n,userAgent:o})}catch(a){console.error("[Audit] Failed to create audit log:",a)}}a.s(["createAuditLog",()=>f])},98246,(a,b,c)=>{"use strict";function d(a){for(let b=0;b<a.length;b++){let c=a[b];if("function"!=typeof c)throw Object.defineProperty(Error(`A "use server" file can only export async functions, found ${typeof c}.
Read more: https://nextjs.org/docs/messages/invalid-use-server-value`),"__NEXT_ERROR_CODE",{value:"E352",enumerable:!1,configurable:!0})}}Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"ensureServerEntryExports",{enumerable:!0,get:function(){return d}})},63707,a=>{"use strict";var b=a.i(38735),c=a.i(61469),d=a.i(37137),e=a.i(3766),f=a.i(50588),g=a.i(9307),h=a.i(54626);a.i(94490);var i=a.i(40356),j=a.i(93411),k=a.i(63985),l=a.i(98246);let m=j.z.object({email:j.z.string().email({message:"Invalid email address"}),password:j.z.string().min(1,{message:"Password is required"})});async function n(a,b){let j=b.get("email"),l=b.get("password"),n=m.safeParse({email:j,password:l});if(!n.success)return{error:n.error.flatten().fieldErrors};let o=(await c.db.select().from(d.users).where((0,e.eq)(d.users.email,j)).limit(1))[0];if(!o||!o.isActive)return await (0,k.createAuditLog)("AUTH_LOGIN_FAILED",void 0,`Attempted email: ${j} (User not found or inactive)`),{message:"Email atau password salah"};if(!await (0,f.compare)(l,o.passwordHash))return await (0,k.createAuditLog)("AUTH_LOGIN_FAILED",o.id,`Attempted email: ${j}`,{id:o.id,username:o.username}),{message:"Email atau password salah"};let p=Array.from(new Set((await c.db.select({slug:d.permissions.slug}).from(d.usersRoles).innerJoin(d.rolesPermissions,(0,e.eq)(d.usersRoles.rolesId,d.rolesPermissions.rolesId)).innerJoin(d.permissions,(0,e.eq)(d.rolesPermissions.permissionsId,d.permissions.id)).where((0,e.eq)(d.usersRoles.usersId,o.id))).map(a=>a.slug))),q=new Date(Date.now()+864e5),r=await (0,g.encrypt)({user:{id:o.id,username:o.username,email:o.email,permissions:p},expires:q});(await (0,h.cookies)()).set("session",r,{expires:q,httpOnly:!0}),await (0,k.createAuditLog)("AUTH_LOGIN_SUCCESS",o.id,`User logged in: ${o.username}`,{id:o.id,username:o.username}),(0,i.redirect)("/admin")}async function o(){await (0,k.createAuditLog)("AUTH_LOGOUT"),(await (0,h.cookies)()).delete("session"),(0,i.redirect)("/admin/login")}(0,l.ensureServerEntryExports)([n,o]),(0,b.registerServerReference)(n,"60700d1c86bf5db80f6bbf4b677e061a135cc02ef7",null),(0,b.registerServerReference)(o,"0065f74676de6a3b4836339edb2ac076d7e582b0d6",null),a.s(["login",()=>n,"logout",()=>o])},59502,a=>{"use strict";var b=a.i(38735),c=a.i(61469),d=a.i(37137),e=a.i(3766),f=a.i(56511);a.i(94490);var g=a.i(40356),h=a.i(93411),i=a.i(9307),j=a.i(26092),k=a.i(63985),l=a.i(98246);let m=h.z.object({id:h.z.number(),isPrimary:h.z.boolean().default(!1),sortOrder:h.z.number().default(0),altText:h.z.string().nullable().default(null)}),n=h.z.object({title:h.z.string().min(1,"Judul wajib diisi"),slug:h.z.string().min(1,"Slug wajib diisi"),location:h.z.string().optional(),description:h.z.string().optional(),completionDate:h.z.string().optional().transform(a=>a?new Date(a):void 0),isActive:h.z.coerce.boolean(),isFeatured:h.z.coerce.boolean()});async function o(a,b){let e=await (0,i.getSession)();if(!e)return{message:"Sesi berakhir, silakan login kembali"};try{await (0,i.checkPermission)(j.PERMISSIONS.MANAGE_PORTFOLIOS)}catch{return{message:"Anda tidak memiliki izin untuk mengelola portofolio"}}let l={title:b.get("title"),slug:b.get("slug"),location:b.get("location"),description:b.get("description"),completionDate:b.get("completionDate"),isActive:"true"===b.get("isActive"),isFeatured:"true"===b.get("isFeatured")},o=[];try{o=h.z.array(m).parse(JSON.parse(b.get("medias")||"[]"))}catch{return{message:"Format data media tidak valid"}}let p=n.safeParse(l);if(!p.success)return{error:p.error.flatten().fieldErrors};let{data:q}=p,r=null;try{let[a]=await c.db.insert(d.portfolios).values({title:q.title,slug:q.slug,location:q.location,description:q.description,completionDate:q.completionDate,isActive:q.isActive,isFeatured:q.isFeatured,createdBy:e.user.id}).$returningId();r=a.id,o.length>0&&await c.db.insert(d.portfolioMedias).values(o.map(a=>({portfolioId:r,mediaId:a.id,isPrimary:a.isPrimary||!1,sortOrder:a.sortOrder||0,altText:a.altText}))),await (0,k.createAuditLog)("PORTFOLIO_CREATE",r,`Created portfolio: ${q.title}`)}catch(a){return console.error(a),{message:"Gagal membuat portofolio: "+(a instanceof Error?a.message:"Terjadi kesalahan tidak dikenal")}}(0,f.revalidatePath)("/admin/portfolios","layout"),(0,f.revalidatePath)("/"),(0,g.redirect)(`/admin/portfolios/${r}/edit`)}async function p(a,b,g){if(!await (0,i.getSession)())return{message:"Sesi berakhir, silakan login kembali"};try{await (0,i.checkPermission)(j.PERMISSIONS.MANAGE_PORTFOLIOS)}catch{return{message:"Anda tidak memiliki izin untuk mengelola portofolio"}}let l={title:g.get("title"),slug:g.get("slug"),location:g.get("location"),description:g.get("description"),completionDate:g.get("completionDate"),isActive:"true"===g.get("isActive"),isFeatured:"true"===g.get("isFeatured")},o=[];try{o=h.z.array(m).parse(JSON.parse(g.get("medias")||"[]"))}catch{return{message:"Format data media tidak valid"}}let p=n.safeParse(l);if(!p.success)return{error:p.error.flatten().fieldErrors};let{data:q}=p;try{await c.db.update(d.portfolios).set({title:q.title,slug:q.slug,location:q.location,description:q.description,completionDate:q.completionDate,isActive:q.isActive,isFeatured:q.isFeatured}).where((0,e.eq)(d.portfolios.id,a)),await c.db.delete(d.portfolioMedias).where((0,e.eq)(d.portfolioMedias.portfolioId,a)),o.length>0&&await c.db.insert(d.portfolioMedias).values(o.map(b=>({portfolioId:a,mediaId:b.id,isPrimary:b.isPrimary||!1,sortOrder:b.sortOrder||0,altText:b.altText}))),await (0,k.createAuditLog)("PORTFOLIO_UPDATE",a,`Updated portfolio: ${q.title}`)}catch(a){return console.error(a),{message:"Gagal mengupdate portofolio: "+(a instanceof Error?a.message:"Terjadi kesalahan tidak dikenal")}}return(0,f.revalidatePath)("/admin/portfolios","layout"),(0,f.revalidatePath)("/"),{success:!0,message:"Portofolio berhasil diperbarui"}}async function q(a,b){try{return await (0,i.checkPermission)(j.PERMISSIONS.MANAGE_PORTFOLIOS),await c.db.update(d.portfolios).set({isFeatured:b}).where((0,e.eq)(d.portfolios.id,a)),await (0,k.createAuditLog)("PORTFOLIO_TOGGLE_FEATURED",a,`Set featured to: ${b}`),(0,f.revalidatePath)("/admin/portfolios","layout"),(0,f.revalidatePath)("/"),{success:!0}}catch(a){return{success:!1,message:a instanceof Error?a.message:"Gagal memperbarui status featured"}}}async function r(a){try{return await (0,i.checkPermission)(j.PERMISSIONS.MANAGE_PORTFOLIOS),await c.db.delete(d.portfolios).where((0,e.eq)(d.portfolios.id,a)),await (0,k.createAuditLog)("PORTFOLIO_DELETE",a,`Deleted portfolio ID: ${a}`),(0,f.revalidatePath)("/admin/portfolios","layout"),(0,f.revalidatePath)("/"),{success:!0}}catch(a){return{success:!1,message:a instanceof Error?a.message:"Gagal menghapus portofolio"}}}(0,l.ensureServerEntryExports)([o,p,q,r]),(0,b.registerServerReference)(o,"60099d2913efe8e4d780621aba93af11f0117b2a12",null),(0,b.registerServerReference)(p,"702b2d4bb5b02f0ee3735881d5d4ba13450614da57",null),(0,b.registerServerReference)(q,"602c8d8fdacb83bc587df691bf76f45bddaa8bc452",null),(0,b.registerServerReference)(r,"4018fa8ffaf0b9924246b7f324cc069810404e1a8d",null),a.s(["createPortfolio",()=>o,"deletePortfolio",()=>r,"togglePortfolioFeatured",()=>q,"updatePortfolio",()=>p])},15064,a=>{"use strict";var b=a.i(63707),c=a.i(59502);a.s([],39501),a.i(39501),a.s(["0065f74676de6a3b4836339edb2ac076d7e582b0d6",()=>b.logout,"4018fa8ffaf0b9924246b7f324cc069810404e1a8d",()=>c.deletePortfolio,"60099d2913efe8e4d780621aba93af11f0117b2a12",()=>c.createPortfolio,"602c8d8fdacb83bc587df691bf76f45bddaa8bc452",()=>c.togglePortfolioFeatured,"702b2d4bb5b02f0ee3735881d5d4ba13450614da57",()=>c.updatePortfolio],15064)}];

//# sourceMappingURL=_f08560f9._.js.map