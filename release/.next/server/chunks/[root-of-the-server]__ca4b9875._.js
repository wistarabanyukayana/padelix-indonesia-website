module.exports=[70406,(e,t,r)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},18622,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},24725,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},24361,(e,t,r)=>{t.exports=e.x("util",()=>require("util"))},93695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},22734,(e,t,r)=>{t.exports=e.x("fs",()=>require("fs"))},21517,(e,t,r)=>{t.exports=e.x("http",()=>require("http"))},24836,(e,t,r)=>{t.exports=e.x("https",()=>require("https"))},2510,e=>{"use strict";var t=e.i(76147),r=e.i(99561),a=e.i(40081),s=e.i(53394),o=e.i(7311),i=e.i(5355),n=e.i(13134),d=e.i(48155),l=e.i(70062),u=e.i(48775),p=e.i(52469),c=e.i(99913),h=e.i(44884),x=e.i(41513),m=e.i(21943),v=e.i(93695);e.i(12197);var f=e.i(5810),R=e.i(61844),g=e.i(43793),w=e.i(18916),b=e.i(63262),y=e.i(1865),E=e.i(93655),k=e.i(24285);async function N(e){try{let t=await e.text(),r=e.headers.get("mux-signature");if(process.env.MUX_WEBHOOK_SECRET&&!r)return R.NextResponse.json({error:"Missing signature"},{status:401});if(process.env.MUX_WEBHOOK_SECRET&&r)try{E.mux.webhooks.verifySignature(t,{"mux-signature":r},process.env.MUX_WEBHOOK_SECRET)}catch{return console.error("[Mux Webhook] Signature verification failed"),R.NextResponse.json({error:"Invalid signature"},{status:401})}let{type:a,data:s}=JSON.parse(t);console.log(`[Mux Webhook] Received event: ${a}`);let o=s.asset_id||s.id,i=s.upload_id||(a.startsWith("video.upload")?s.id:null),n=null;if(o&&(n=(await g.db.select().from(w.medias).where((0,b.eq)(w.medias.fileKey,o)).limit(1))[0]),!n&&i&&(n=(await g.db.select().from(w.medias).where((0,b.eq)(w.medias.fileKey,i)).limit(1))[0]),!n){if("video.asset.deleted"===a)return R.NextResponse.json({received:!0});return console.warn(`[Mux Webhook] No media found for Asset:${o} / Upload:${i}`),R.NextResponse.json({received:!0})}console.log(`[Mux Webhook] Processing event: ${a} for media ID: ${n.id}`),await (0,k.createAuditLog)(`WEBHOOK_MUX_${a.replace(/\./g,"_").toUpperCase()}`,n.id,`Processing Mux event: ${a}`);let d=(e=>{if(!e)return{};if("string"==typeof e)try{return JSON.parse(e)}catch{return{}}if("object"==typeof e&&null!==e&&"0"in e&&"1"in e){console.warn("[Mux Webhook] Detected corrupted indexed-string metadata, attempting recovery");try{let t=[];Object.keys(e).forEach(r=>{isNaN(Number(r))||(t[t.length]=e[r])});let r=t.join(""),a={...JSON.parse(r)};return Object.keys(e).forEach(t=>{isNaN(Number(t))&&(a[t]=e[t])}),a}catch{}}return e})(n.metadata);if("video.upload.asset_created"===a||"video.asset.created"===a){let e=s.playback_ids?.[0]?.id||d.playbackId;await g.db.update(w.medias).set({fileKey:o,url:e?`https://stream.mux.com/${e}.m3u8`:n.url,metadata:{...d,assetId:o,uploadId:i||d.uploadId,playbackId:e,status:s.status||d.status}}).where((0,b.eq)(w.medias.id,n.id)),console.log(`[Mux Webhook] Linked media ${n.id} to asset ${o}`)}if("video.asset.ready"===a||"video.asset.errored"===a){let e=s.playback_ids?.[0]?.id||d.playbackId;await g.db.update(w.medias).set({fileKey:o,url:e?`https://stream.mux.com/${e}.m3u8`:n.url,metadata:{...d,status:s.status,duration:s.duration??d.duration,aspectRatio:s.aspect_ratio??d.aspectRatio,playbackId:e,error:s.errors?JSON.stringify(s.errors):void 0}}).where((0,b.eq)(w.medias.id,n.id)),console.log(`[Mux Webhook] Media ${n.id} is now ${s.status}`)}return"video.asset.deleted"===a&&(await g.db.delete(w.medias).where((0,b.eq)(w.medias.id,n.id)),console.log(`[Mux Webhook] Deleted media ${n.id} due to Mux deletion`)),(0,y.revalidatePath)("/admin","layout"),(0,y.revalidatePath)("/admin/media"),R.NextResponse.json({received:!0})}catch(e){return console.error("Mux Webhook Error:",e),R.NextResponse.json({error:"Webhook handler failed"},{status:500})}}e.s(["POST",()=>N],37614);var C=e.i(37614);let _=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/webhooks/mux/route",pathname:"/api/webhooks/mux",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/webhooks/mux/route.ts",nextConfigOutput:"standalone",userland:C}),{workAsyncStorage:O,workUnitAsyncStorage:A,serverHooks:q}=_;function M(){return(0,a.patchFetch)({workAsyncStorage:O,workUnitAsyncStorage:A})}async function P(e,t,a){_.isDev&&(0,s.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let R="/api/webhooks/mux/route";R=R.replace(/\/index$/,"")||"/";let g=await _.prepare(e,t,{srcPage:R,multiZoneDraftMode:!1});if(!g)return t.statusCode=400,t.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve()),null;let{buildId:w,params:b,nextConfig:y,parsedUrl:E,isDraftMode:k,prerenderManifest:N,routerServerContext:C,isOnDemandRevalidate:O,revalidateOnlyGenerated:A,resolvedPathname:q,clientReferenceManifest:M,serverActionsManifest:P}=g,S=(0,n.normalizeAppPath)(R),j=!!(N.dynamicRoutes[S]||N.routes[q]),T=async()=>((null==C?void 0:C.render404)?await C.render404(e,t,E,!1):t.end("This page could not be found"),null);if(j&&!k){let e=!!N.routes[q],t=N.dynamicRoutes[S];if(t&&!1===t.fallback&&!e){if(y.experimental.adapterPath)return await T();throw new v.NoFallbackError}}let I=null;!j||_.isDev||k||(I="/index"===(I=q)?"/":I);let $=!0===_.isDev||!j,U=j&&!$;P&&M&&(0,i.setManifestsSingleton)({page:R,clientReferenceManifest:M,serverActionsManifest:P});let H=e.method||"GET",W=(0,o.getTracer)(),D=W.getActiveScopeSpan(),K={params:b,prerenderManifest:N,renderOpts:{experimental:{authInterrupts:!!y.experimental.authInterrupts},cacheComponents:!!y.cacheComponents,supportsDynamicResponse:$,incrementalCache:(0,s.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:y.cacheLife,waitUntil:a.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,a,s)=>_.onRequestError(e,t,a,s,C)},sharedContext:{buildId:w}},B=new d.NodeNextRequest(e),F=new d.NodeNextResponse(t),L=l.NextRequestAdapter.fromNodeNextRequest(B,(0,l.signalFromNodeResponse)(t));try{let i=async e=>_.handle(L,K).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=W.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==u.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let a=r.get("next.route");if(a){let t=`${H} ${a}`;e.setAttributes({"next.route":a,"http.route":a,"next.span_name":t}),e.updateName(t)}else e.updateName(`${H} ${R}`)}),n=!!(0,s.getRequestMeta)(e,"minimalMode"),d=async s=>{var o,d;let l=async({previousCacheEntry:r})=>{try{if(!n&&O&&A&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let o=await i(s);e.fetchMetrics=K.renderOpts.fetchMetrics;let d=K.renderOpts.pendingWaitUntil;d&&a.waitUntil&&(a.waitUntil(d),d=void 0);let l=K.renderOpts.collectedTags;if(!j)return await (0,c.sendResponse)(B,F,o,K.renderOpts.pendingWaitUntil),null;{let e=await o.blob(),t=(0,h.toNodeOutgoingHttpHeaders)(o.headers);l&&(t[m.NEXT_CACHE_TAGS_HEADER]=l),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==K.renderOpts.collectedRevalidate&&!(K.renderOpts.collectedRevalidate>=m.INFINITE_CACHE)&&K.renderOpts.collectedRevalidate,a=void 0===K.renderOpts.collectedExpire||K.renderOpts.collectedExpire>=m.INFINITE_CACHE?void 0:K.renderOpts.collectedExpire;return{value:{kind:f.CachedRouteKind.APP_ROUTE,status:o.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:a}}}}catch(t){throw(null==r?void 0:r.isStale)&&await _.onRequestError(e,t,{routerKind:"App Router",routePath:R,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:U,isOnDemandRevalidate:O})},!1,C),t}},u=await _.handleResponse({req:e,nextConfig:y,cacheKey:I,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:N,isRoutePPREnabled:!1,isOnDemandRevalidate:O,revalidateOnlyGenerated:A,responseGenerator:l,waitUntil:a.waitUntil,isMinimalMode:n});if(!j)return null;if((null==u||null==(o=u.value)?void 0:o.kind)!==f.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==u||null==(d=u.value)?void 0:d.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});n||t.setHeader("x-nextjs-cache",O?"REVALIDATED":u.isMiss?"MISS":u.isStale?"STALE":"HIT"),k&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let v=(0,h.fromNodeOutgoingHttpHeaders)(u.value.headers);return n&&j||v.delete(m.NEXT_CACHE_TAGS_HEADER),!u.cacheControl||t.getHeader("Cache-Control")||v.get("Cache-Control")||v.set("Cache-Control",(0,x.getCacheControlHeader)(u.cacheControl)),await (0,c.sendResponse)(B,F,new Response(u.value.body,{headers:v,status:u.value.status||200})),null};D?await d(D):await W.withPropagatedContext(e.headers,()=>W.trace(u.BaseServerSpan.handleRequest,{spanName:`${H} ${R}`,kind:o.SpanKind.SERVER,attributes:{"http.method":H,"http.target":e.url}},d))}catch(t){if(t instanceof v.NoFallbackError||await _.onRequestError(e,t,{routerKind:"App Router",routePath:S,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:U,isOnDemandRevalidate:O})},!1,C),j)throw t;return await (0,c.sendResponse)(B,F,new Response(null,{status:500})),null}}e.s(["handler",()=>P,"patchFetch",()=>M,"routeModule",()=>_,"serverHooks",()=>q,"workAsyncStorage",()=>O,"workUnitAsyncStorage",()=>A],2510)},48989,e=>{e.v(t=>Promise.all(["server/chunks/[root-of-the-server]__4ebef9ad._.js"].map(t=>e.l(t))).then(()=>t(66017)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__ca4b9875._.js.map