module.exports=[55304,(e,t,a)=>{"use strict";t.exports=e.r(8433).vendored["react-rsc"].ReactServerDOMTurbopackServer},30586,(e,t,a)=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0}),Object.defineProperty(a,"registerServerReference",{enumerable:!0,get:function(){return r.registerServerReference}});let r=e.r(55304)},61506,(e,t,a)=>{"use strict";function r(e){for(let t=0;t<e.length;t++){let a=e[t];if("function"!=typeof a)throw Object.defineProperty(Error(`A "use server" file can only export async functions, found ${typeof a}.
Read more: https://nextjs.org/docs/messages/invalid-use-server-value`),"__NEXT_ERROR_CODE",{value:"E352",enumerable:!1,configurable:!0})}}Object.defineProperty(a,"__esModule",{value:!0}),Object.defineProperty(a,"ensureServerEntryExports",{enumerable:!0,get:function(){return r}})},69642,e=>{"use strict";var t=e.i(76147),a=e.i(99561),r=e.i(40081),i=e.i(53394),n=e.i(7311),s=e.i(5355),o=e.i(13134),l=e.i(48155),d=e.i(70062),u=e.i(48775),c=e.i(52469),p=e.i(99913),f=e.i(44884),m=e.i(41513),h=e.i(21943),g=e.i(93695);e.i(12197);var w=e.i(5810),y=e.i(61844),v=e.i(30586),b=e.i(43793),R=e.i(18916),E=e.i(24868),k=e.i(14747),S=e.i(79832),A=e.i(63262),P=e.i(3257),x=e.i(93655);let j="manage_media";var T=e.i(1865),C=e.i(24285);async function N(){if(!await (0,S.getSession)())return[];try{await (0,S.checkPermission)(j);let e=(0,k.join)(process.cwd(),"public","uploads"),t=[],a=async(e,r)=>{for(let i of(await (0,E.readdir)(e,{withFileTypes:!0})))if(i.isDirectory()){let n=r?`${r}/${i.name}`:i.name;t.push(n),await a((0,k.join)(e,i.name),n)}};return await a(e,""),t}catch(e){return console.error("Get folders error:",e),[]}}async function O(e){if(!await (0,S.getSession)())return{message:"Sesi berakhir, silakan login kembali"};try{if(await (0,S.checkPermission)(j),e.includes("..")||e.startsWith("/"))return{message:"Nama folder tidak valid"};let t=(0,k.join)(process.cwd(),"public","uploads"),a=(0,k.join)(t,e);try{return await (0,E.stat)(a),{message:"Folder sudah ada"}}catch{}return await (0,E.mkdir)(a,{recursive:!0}),await (0,C.createAuditLog)("MEDIA_FOLDER_CREATE",void 0,`Created folder: ${e}`),(0,T.revalidatePath)("/admin","layout"),{success:!0,message:"Folder berhasil dibuat"}}catch(e){return{message:"Gagal membuat folder: "+(e instanceof Error?e.message:"Terjadi kesalahan")}}}async function _(t){if(!await (0,S.getSession)())return{message:"Sesi berakhir, silakan login kembali"};try{if(await (0,S.checkPermission)(j),t.includes("..")||t.startsWith("/"))return{message:"Nama folder tidak valid"};let a=(0,k.join)(process.cwd(),"public","uploads"),r=(0,k.join)(a,t);try{await (0,E.stat)(r)}catch{return{message:"Folder tidak ditemukan"}}if((await (0,E.readdir)(r)).length>0)return{message:"Folder tidak kosong. Harap hapus atau pindahkan isinya terlebih dahulu."};let{rmdir:i}=await e.A(60815);return await i(r),await (0,C.createAuditLog)("MEDIA_FOLDER_DELETE",void 0,`Deleted folder: ${t}`),(0,T.revalidatePath)("/admin","layout"),{success:!0,message:"Folder berhasil dihapus"}}catch(e){return{message:"Gagal menghapus folder: "+(e instanceof Error?e.message:"Terjadi kesalahan")}}}async function D(e){if(!await (0,S.getSession)())return{error:"Sesi berakhir, silakan login kembali"};try{await (0,S.checkPermission)(j);let t=e.get("file");if(!t)return{error:"Tidak ada file yang diunggah"};let a=e.get("folder"),r="other";if(t.type.startsWith("image/")?r="image":t.type.startsWith("video/")?r="video":t.type.startsWith("audio/")?r="audio":("application/pdf"===t.type||t.type.includes("msword")||t.type.includes("officedocument"))&&(r="document"),t.size>0x3200000)return{error:"Ukuran file maksimal 50MB"};let i=await t.arrayBuffer(),n=Buffer.from(i),s=t.name.replace(/[^a-zA-Z0-9.-]/g,"_"),o=Date.now()+"-"+Math.round(1e9*Math.random()),l=`${o}-${s}`,d=(0,k.join)(process.cwd(),"public","uploads");await (0,E.mkdir)(d,{recursive:!0});let u=(0,k.join)(d,l);await (0,E.writeFile)(u,n);let c=`/uploads/${l}`,[p]=await b.db.insert(R.medias).values({name:t.name,fileKey:l,type:r,provider:"local",mimeType:t.type,fileSize:t.size,url:c,metadata:a?{folder:a}:null}).$returningId();return await (0,C.createAuditLog)("MEDIA_UPLOAD",p.id,`Uploaded file: ${t.name} (local)`),(0,T.revalidatePath)("/admin","layout"),{url:c,id:p.id}}catch(e){return console.error("Upload error:",e),{error:"Gagal mengunggah file: "+(e instanceof Error?e.message:"Terjadi kesalahan tidak dikenal")}}}async function M(e){if(!await (0,S.getSession)())return{message:"Sesi berakhir, silakan login kembali"};try{await (0,S.checkPermission)(j);let t=(await b.db.select().from(R.medias).where((0,A.eq)(R.medias.id,e)).limit(1))[0];if(!t)return{message:"Media tidak ditemukan"};if("local"===t.provider){let e=(0,k.join)(process.cwd(),"public",t.url.startsWith("/")?t.url.substring(1):t.url);try{await (0,E.unlink)(e)}catch(e){console.error("Failed to delete local file:",e)}}else if("mux"===t.provider){let e=t.metadata;if(e?.assetId)try{await x.mux.video.assets.delete(e.assetId)}catch(e){console.error("Failed to delete Mux asset:",e)}}return await b.db.delete(R.medias).where((0,A.eq)(R.medias.id,e)),await (0,C.createAuditLog)("MEDIA_DELETE",e,`Deleted media: ${t.name}`),(0,T.revalidatePath)("/admin","layout"),{success:!0,message:"Media berhasil dihapus"}}catch(e){return console.error("Delete media error:",e),{message:"Gagal menghapus media: "+(e instanceof Error?e.message:"Terjadi kesalahan tidak dikenal")}}}async function $(){if(!await (0,S.getSession)())return[];try{return await (0,S.checkPermission)(j),await b.db.select().from(R.medias).orderBy((0,P.desc)(R.medias.createdAt))}catch(e){return console.error("Get medias error:",e),[]}}async function I(e,t){if(!await (0,S.getSession)())return{message:"Sesi berakhir, silakan login kembali"};try{await (0,S.checkPermission)(j);let a=(await b.db.select().from(R.medias).where((0,A.eq)(R.medias.id,e)).limit(1))[0];if(!a)return{message:"Media tidak ditemukan"};let r=function(e){if(!e)return{};if("string"==typeof e)try{return JSON.parse(e)}catch{return{}}if("object"==typeof e&&null!==e&&"0"in e&&"1"in e)try{let t=[];Object.keys(e).forEach(a=>{isNaN(Number(a))||(t[t.length]=e[a])});let a=t.join(""),r={...JSON.parse(a)};return Object.keys(e).forEach(t=>{isNaN(Number(t))&&(r[t]=e[t])}),r}catch{}return e}(a.metadata);return await b.db.update(R.medias).set({metadata:{...r,folder:t||null}}).where((0,A.eq)(R.medias.id,e)),await (0,C.createAuditLog)("MEDIA_MOVE",e,`Moved media ${a.name} to folder: ${t||"Root"}`),(0,T.revalidatePath)("/admin","layout"),{success:!0,message:"Media berhasil dipindahkan"}}catch(e){return{message:"Gagal memindahkan media: "+(e instanceof Error?e.message:"Terjadi kesalahan")}}}async function F(){if(!await (0,S.getSession)())return{message:"Sesi berakhir, silakan login kembali"};try{await (0,S.checkPermission)(j);let e=(0,k.join)(process.cwd(),"public"),t=0,a=await b.db.select({url:R.medias.url}).from(R.medias),r=new Set(a.map(e=>e.url)),i=async a=>{let n=(0,k.join)(e,a);for(let s of(await (0,E.readdir)(n,{withFileTypes:!0}))){let n=(0,k.join)(a,s.name),o=`/${n.replace(/\\/g,"/")}`;if(s.isDirectory())await i(n);else if(!r.has(o)){let r=await (0,E.stat)((0,k.join)(e,n)),i=s.name.split(".").pop()?.toLowerCase(),l="other";["jpg","jpeg","png","gif","webp","svg"].includes(i||"")?l="image":["mp4","webm","ogg"].includes(i||"")?l="video":["pdf","doc","docx"].includes(i||"")?l="document":["mp3","wav"].includes(i||"")&&(l="audio");let d=null,u=a.replace(/\\/g,"/");d=u.startsWith("uploads/")?u.replace("uploads/",""):"uploads"===u?null:u,""===d&&(d=null),await b.db.insert(R.medias).values({name:s.name,fileKey:o,type:l,provider:"local",mimeType:`${l}/${i}`,fileSize:r.size,url:o,metadata:d?{folder:d}:null}),t++}}};for(let t of["uploads"]){let a=(0,k.join)(e,t);try{await (0,E.mkdir)(a,{recursive:!0}),await i(t)}catch(e){console.error(`Failed to sync folder ${t}:`,e)}}return await (0,C.createAuditLog)("MEDIA_SYNC",void 0,`Synchronized filesystem. Added ${t} files.`),(0,T.revalidatePath)("/admin","layout"),{success:!0,message:`Sinkronisasi selesai. ${t} file baru ditambahkan.`,addedCount:t}}catch(e){return console.error("Sync error:",e),{message:"Gagal sinkronisasi: "+(e instanceof Error?e.message:"Terjadi kesalahan")}}}async function U(e){try{let t=await e.formData(),a=await D(t);if(a.error)return y.NextResponse.json({error:a.error},{status:400});return y.NextResponse.json(a)}catch(e){return console.error("API Upload Error:",e),y.NextResponse.json({error:"Internal Server Error"},{status:500})}}(0,e.i(61506).ensureServerEntryExports)([N,O,_,D,M,$,I,F]),(0,v.registerServerReference)(N,"0039e6f4d93c612e9432cd78ee8cbc92260a14fa7c",null),(0,v.registerServerReference)(O,"406ff7d3af401edf92b2984e240871274e46bb3446",null),(0,v.registerServerReference)(_,"40c944e5b0c4c33ee1ee96067b7c69a49106edc40b",null),(0,v.registerServerReference)(D,"40d1fbcb5529ac8f2bc18816eb1d3c478818f9fbe2",null),(0,v.registerServerReference)(M,"4020377e801a0cc64e1a42febf16bf8e4995f2cf7f",null),(0,v.registerServerReference)($,"00cfd698a314c7d2a63fa7bd7fa56ea7cf3febe247",null),(0,v.registerServerReference)(I,"60a088e6d105144a94fa2824812100df7fdd6a8818",null),(0,v.registerServerReference)(F,"00407ab671b4a0818fff7ed31ffb79f10f964adcd8",null),e.s(["POST",()=>U],1365);var q=e.i(1365);let H=new t.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/media/upload/route",pathname:"/api/media/upload",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/media/upload/route.ts",nextConfigOutput:"standalone",userland:q}),{workAsyncStorage:L,workUnitAsyncStorage:G,serverHooks:K}=H;function B(){return(0,r.patchFetch)({workAsyncStorage:L,workUnitAsyncStorage:G})}async function W(e,t,r){H.isDev&&(0,i.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let y="/api/media/upload/route";y=y.replace(/\/index$/,"")||"/";let v=await H.prepare(e,t,{srcPage:y,multiZoneDraftMode:!1});if(!v)return t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve()),null;let{buildId:b,params:R,nextConfig:E,parsedUrl:k,isDraftMode:S,prerenderManifest:A,routerServerContext:P,isOnDemandRevalidate:x,revalidateOnlyGenerated:j,resolvedPathname:T,clientReferenceManifest:C,serverActionsManifest:N}=v,O=(0,o.normalizeAppPath)(y),_=!!(A.dynamicRoutes[O]||A.routes[T]),D=async()=>((null==P?void 0:P.render404)?await P.render404(e,t,k,!1):t.end("This page could not be found"),null);if(_&&!S){let e=!!A.routes[T],t=A.dynamicRoutes[O];if(t&&!1===t.fallback&&!e){if(E.experimental.adapterPath)return await D();throw new g.NoFallbackError}}let M=null;!_||H.isDev||S||(M="/index"===(M=T)?"/":M);let $=!0===H.isDev||!_,I=_&&!$;N&&C&&(0,s.setManifestsSingleton)({page:y,clientReferenceManifest:C,serverActionsManifest:N});let F=e.method||"GET",U=(0,n.getTracer)(),q=U.getActiveScopeSpan(),L={params:R,prerenderManifest:A,renderOpts:{experimental:{authInterrupts:!!E.experimental.authInterrupts},cacheComponents:!!E.cacheComponents,supportsDynamicResponse:$,incrementalCache:(0,i.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:E.cacheLife,waitUntil:r.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,a,r,i)=>H.onRequestError(e,t,r,i,P)},sharedContext:{buildId:b}},G=new l.NodeNextRequest(e),K=new l.NodeNextResponse(t),B=d.NextRequestAdapter.fromNodeNextRequest(G,(0,d.signalFromNodeResponse)(t));try{let s=async e=>H.handle(B,L).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let a=U.getRootSpanAttributes();if(!a)return;if(a.get("next.span_type")!==u.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${a.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let r=a.get("next.route");if(r){let t=`${F} ${r}`;e.setAttributes({"next.route":r,"http.route":r,"next.span_name":t}),e.updateName(t)}else e.updateName(`${F} ${y}`)}),o=!!(0,i.getRequestMeta)(e,"minimalMode"),l=async i=>{var n,l;let d=async({previousCacheEntry:a})=>{try{if(!o&&x&&j&&!a)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let n=await s(i);e.fetchMetrics=L.renderOpts.fetchMetrics;let l=L.renderOpts.pendingWaitUntil;l&&r.waitUntil&&(r.waitUntil(l),l=void 0);let d=L.renderOpts.collectedTags;if(!_)return await (0,p.sendResponse)(G,K,n,L.renderOpts.pendingWaitUntil),null;{let e=await n.blob(),t=(0,f.toNodeOutgoingHttpHeaders)(n.headers);d&&(t[h.NEXT_CACHE_TAGS_HEADER]=d),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let a=void 0!==L.renderOpts.collectedRevalidate&&!(L.renderOpts.collectedRevalidate>=h.INFINITE_CACHE)&&L.renderOpts.collectedRevalidate,r=void 0===L.renderOpts.collectedExpire||L.renderOpts.collectedExpire>=h.INFINITE_CACHE?void 0:L.renderOpts.collectedExpire;return{value:{kind:w.CachedRouteKind.APP_ROUTE,status:n.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:a,expire:r}}}}catch(t){throw(null==a?void 0:a.isStale)&&await H.onRequestError(e,t,{routerKind:"App Router",routePath:y,routeType:"route",revalidateReason:(0,c.getRevalidateReason)({isStaticGeneration:I,isOnDemandRevalidate:x})},!1,P),t}},u=await H.handleResponse({req:e,nextConfig:E,cacheKey:M,routeKind:a.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:A,isRoutePPREnabled:!1,isOnDemandRevalidate:x,revalidateOnlyGenerated:j,responseGenerator:d,waitUntil:r.waitUntil,isMinimalMode:o});if(!_)return null;if((null==u||null==(n=u.value)?void 0:n.kind)!==w.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==u||null==(l=u.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});o||t.setHeader("x-nextjs-cache",x?"REVALIDATED":u.isMiss?"MISS":u.isStale?"STALE":"HIT"),S&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let g=(0,f.fromNodeOutgoingHttpHeaders)(u.value.headers);return o&&_||g.delete(h.NEXT_CACHE_TAGS_HEADER),!u.cacheControl||t.getHeader("Cache-Control")||g.get("Cache-Control")||g.set("Cache-Control",(0,m.getCacheControlHeader)(u.cacheControl)),await (0,p.sendResponse)(G,K,new Response(u.value.body,{headers:g,status:u.value.status||200})),null};q?await l(q):await U.withPropagatedContext(e.headers,()=>U.trace(u.BaseServerSpan.handleRequest,{spanName:`${F} ${y}`,kind:n.SpanKind.SERVER,attributes:{"http.method":F,"http.target":e.url}},l))}catch(t){if(t instanceof g.NoFallbackError||await H.onRequestError(e,t,{routerKind:"App Router",routePath:O,routeType:"route",revalidateReason:(0,c.getRevalidateReason)({isStaticGeneration:I,isOnDemandRevalidate:x})},!1,P),_)throw t;return await (0,p.sendResponse)(G,K,new Response(null,{status:500})),null}}e.s(["handler",()=>W,"patchFetch",()=>B,"routeModule",()=>H,"serverHooks",()=>K,"workAsyncStorage",()=>L,"workUnitAsyncStorage",()=>G],69642)}];

//# sourceMappingURL=1629d_next_dist_d6361912._.js.map